<craft>
    <parameter name="angle" type="string" default="60"/>

    <script type="text/openjscad">

        function main(params){
            var ang = params.angle.split(','); // = params.angle
            var data = []
            var part = sixty() //initialize

            ang.forEach(function(angle){
                var part = sixty();

                if(angle < 60){
                    part = intersection(
                        sixty(),
                        part.rotateZ(60-angle)
                    ).translate([0,-5,0]);
                } else if(angle >= 60 && angle < 120){
                    part = union(
                        sixty(),
                        part.rotateZ(angle-60)
                    );
                } else if(angle >= 120 && angle<180){
                    part = union(
                        onetwenty(),
                        part.rotateZ(angle-60)
                    )
                }
                data.push(part)
            })

            var pie = difference(
                cylinder({r:20, h:3, fn:100})
                ,part
            )
/*
            data.forEach(function(d){
                wholepie = difference(
                    wholepie
                    ,d
                )
            });
*/
            return union(
                pie,
                part.translate([1,-1,0])
            );
        }
/*
            if(angle === 30)
                part = thirty()
            else if(angle === 45)
                part = fourtyfive()
            else if(angle === 60)
                part = sixty()
            else if(angle === 90)
                part = ninety()
            else if(angle === 120)
                part = onetwenty()
            else if(angle === 180)
                part = oneeighty()
                
            var pie = difference(
                cylinder({r:20, h:3, fn:100})
                ,part
            )
            return union(
                pie,
                part.translate([1,-1,0])
            );
        }
*/
        function oneeighty(){
            return union(
                ninety(),
                ninety().rotateZ(90)
            );
        }

        function onetwenty(){
            
            return union(
                ninety().rotateZ(30),
                thirty()
                );
        }

        function ninety(){
            return union(
                sixty().rotateZ(30),
                thirty()
            );
        }

        function thirty(){
            
            return difference(
                sixty(),
                sixty().rotateZ(30).setColor([1,0,0])
            );
        }

        function fourtyfive(){
            
            return union(
                 thirty(),
                 thirty().rotateZ(15)
            );
        }
        function sixty() {
                
            var angle = 60
                ,iter = Math.floor(360/angle)
                    
            var pie = cylinder({r:20, h:3, fn:100}).setColor([0,1,1])
                ,block = cube([40,40,3]).translate([-20,0,0])

            
            for(var i=0; i<iter-1; i++){
                //block = block.rotateZ(angle)
                angle = angle*(i+1)
                pie = difference(
                        pie,
                        block.rotateZ(angle)
                    )
            }
                    
            return pie;
        }


    </script>
</craft>

