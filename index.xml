<craft>
    <parameter name="angle" type="string" default="60"/>

    <script type="text/openjscad">

        function main(params){
            var ang = params.angle.split(',') // = params.angle
                ,data = []
                ,part = sixty()
                ,anglesum = 0 //initialize

            ang.forEach(function(angle){
                var part = sixty();

                if(angle < 60){
                    part = intersection(
                        sixty(),
                        part.rotateZ(60-angle)
                    ).translate([0,-5,0]);
                } else if(angle >= 60 && angle < 120){
                    part = union(
                        sixty(),
                        part.rotateZ(angle-60)
                    );
                } else if(angle >= 120 && angle<180){
                    part = union(
                        onetwenty(),
                        part.rotateZ(angle-60)
                    )
                }
                part = part.rotateZ(anglesum)
                anglesum = anglesum + angle

                data.push(part)
            })

            var pie = cylinder({r:20, h:3, fn:100})

            data.forEach(function(d, i){ //construct left over pie
                pie = difference(
                    pie
                    ,d
                )
            });

            data.forEach(function(d){ //build the entire pie
                pie = union(
                    pie,
                    d// translate in cos,sin theta
                )
            });

            return pie
            /*
            return union(
                pie,
                part.translate([1,-1,0])
            );
*/
        }

        function sixty() {
                
            var angle = 60
                ,iter = Math.floor(360/angle)
                    
            var pie = cylinder({r:20, h:3, fn:100}).setColor([0,1,1])
                ,block = cube([40,40,3]).translate([-20,0,0])

            
            for(var i=0; i<iter-1; i++){
                //block = block.rotateZ(angle)
                angle = angle*(i+1)
                pie = difference(
                        pie,
                        block.rotateZ(angle)
                    )
            }
                    
            return pie;
        }


    </script>
</craft>

